# WeTalk Whisper智能语音识别纠错功能

## 功能概述

WeTalk现在集成了智能的Whisper prompt功能，可以显著提高语音识别的准确性，特别是对于中日文混合对话中的专有名词、地名和常用词汇。

## 主要特性

### 1. 上下文感知的prompt
- 自动分析对话历史，提取关键词汇
- 根据上下文推断可能出现的词汇
- 动态调整prompt内容以适应当前对话场景

### 2. 语言特定的词汇库
- **中文模式**：包含日本地名、交通工具、常用旅游词汇等
- **日文模式**：包含中国地名、交通相关、常用商务词汇等
- **混合模式**：智能平衡两种语言的词汇

### 3. 场景识别
- **旅游场景**：自动添加酒店、景点、交通相关词汇
- **购物场景**：包含商店、价格、免税等词汇
- **餐饮场景**：添加料理、餐厅、菜单相关词汇
- **交通场景**：重点优化车站、线路、换乘等词汇

### 4. 常见错误纠正
系统会特别关注以下容易识别错误的词汇：

#### 日本地名
- 白滨 (しらはま)
- 银座 (ぎんざ)
- 涩谷 (しぶや)
- 新宿 (しんじゅく)
- 原宿 (はらじゅく)
- 浅草 (あさくさ)

#### 交通相关
- JR线
- 新干线
- 山手线
- 中央线
- 地铁换乘

#### 常用词汇
- 便利店
- 药妆店
- 居酒屋
- 温泉
- 免税

## 使用方法

### 启用/禁用功能
1. 点击右上角的设置按钮 ⚙️
2. 在"语音识别优化"部分找到"智能语音识别纠错"开关
3. 切换开关来启用或禁用此功能

### 最佳实践
1. **保持对话连贯**：系统会根据前几条消息的内容优化识别
2. **明确场景**：在对话开始时提及具体场景（如"我要去东京旅游"）
3. **使用常见词汇**：系统对常用的地名、交通工具识别效果更好

## 技术实现

### Prompt生成策略
1. **上下文分析**：分析最近5条消息，提取关键词
2. **语言检测**：统计中日文字符比例，确定主要语言
3. **场景识别**：根据关键词判断对话场景
4. **词汇优先级**：
   - 上下文关键词（最高优先级）
   - 场景相关词汇
   - 语言特定常用词汇

### 性能优化
- Prompt长度限制在200字符以内（符合Whisper API要求）
- 词汇数量限制在30个以内
- 智能去重，避免重复词汇

## 注意事项

1. **API配额**：启用此功能不会增加额外的API调用次数
2. **隐私保护**：所有处理都在本地进行，不会上传额外数据
3. **兼容性**：适用于所有支持Whisper API的OpenAI账户
4. **语言支持**：目前主要优化中文和日文，其他语言效果可能有限

## 故障排除

### 如果识别效果没有改善
1. 确认功能已启用
2. 检查对话是否有足够的上下文
3. 尝试在对话中明确提及场景关键词
4. 确保API密钥有效且有足够配额

### 如果出现识别错误
1. 可以临时关闭此功能进行对比测试
2. 检查是否是特定词汇的问题
3. 在GitHub上反馈具体的错误案例

## 更新日志

### v1.0.0 (当前版本)
- 实现基础的上下文感知prompt
- 添加中日文词汇库
- 支持场景识别
- 提供用户开关控制

## 反馈与建议

如果您发现某些词汇经常被误识别，或者希望添加特定场景的词汇支持，欢迎提供反馈。我们会持续优化词汇库和识别算法。 